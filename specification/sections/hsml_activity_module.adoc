== HSML Activity Module

=== Architectural Principles and Design Rationale

This clause describes the architectural principles underlying the HSML Activity Module. These principles are *informative* and not required for conformance; however, understanding them is recommended to ensure robust and correct implementations.

==== The Schema/Instance Pattern: Enabling Scalable Governance

A fundamental principle of this standard is the strict separation between the *definition* of an activity and the *record of its execution*. This separation is realized through two distinct HSML classes:

* `act:ActivitySchema` — A reusable, design-time template that specifies the type of action, its required inputs, expected outputs, and the conditions under which it is valid.
* `act:Activity` — An execution-time entity representing a single, concrete, stateful instance of an `act:ActivitySchema` performed by a specific agent at a specific time.

Normative requirements:

. An `act:Activity` *shall* reference exactly one `act:ActivitySchema` via the `act:activitySchema` property, in accordance with IEEE P2874 §6.6.3.
. An `act:Activity` *shall* conform to all structural and behavioral constraints defined in its referenced `act:ActivitySchema`,  as required in IEEE P2874 §6.6.3.
. An `act:ActivitySchema` *shall* be identified by a Spatial Web Identifier (SWID) conforming to W3C DID Core syntax, as required in IEEE P2874 §6.4.4.2. This implies that `act:ActivitySchema` shall be a subclass of `hsml:Entity`, which is the base class for all Spatial Web entities.
. An `act:ActivitySchema` *should* be defined, versioned, and published by an authoritative registry under the control of a recognized Domain Authority,in accordance with IEEE P2874 §6.5.5.4. to ensure traceability, governance, and interoperability across domains.
. Validation of an `act:Activity` against its `act:ActivitySchema` *shall* be performed using formal constraint definitions (e.g., SHACL shapes), and such validation *shall* be applied both prior to execution (pre-condition checking) and upon completion (post-condition verification), in accordance with IEEE P2874 §6.6.3.

This separation is a cornerstone of governance and scalability within the Spatial Web. It enables a "trust-by-reference" model:

* First, a trusted entity (e.g., a domain authority or standards body) vets and publishes an `act:ActivitySchema` to a known, trusted registry.
* This schema represents an approved pattern of action.
* Any number of autonomous agents may then propose or perform an action by creating an `act:Activity` instance that normatively links to the approved schema via the `act:activitySchema` property.

An orchestration engine, smart contract, or other governance mechanism can then validate the proposed action with high efficiency. Rather than analyzing the internal logic of the action itself, the validator only needs to check whether this `act:Activity` references an `act:ActivitySchema` from an approved registry. This decouples the high-level, infrequent work of policy definition (approving schemas) from the high-frequency, operational work of validation (checking activities), producing a highly scalable and secure governance framework.

By enforcing SHACL-based conformance checks against authoritative, DID-identified schemas, this architecture ensures that every `act:Activity` instance *shall* conform to a known, verifiable, and trusted pattern—supporting interoperability, auditability, and compliance across the Spatial Web.

==== Domain-Specific Governance of Referenced Schemas

A core tenet of the Spatial Web's architecture is that domains can apply **local, context-specific governance** to universal, standardized `act:ActivitySchema` definitions without modifying the original schema. In a holonic structure, a domain can incorporate an activity schema by reference, making it a functional member of the domain's capabilities. This allows for both global interoperability by using a common schema and local autonomy by enforcing domain-specific rules.

This is achieved by separating the activity's definition (`act:ActivitySchema`) from the rules governing its execution within a domain. The primary mechanism for enforcing these domain-specific rules, or **norms**, is the requirement of a domain-specific **CREDENTIAL**.

===== Governance Workflow

A Domain Authority (DA) shall apply local norms to a referenced `act:ActivitySchema` by following this workflow:

1.  **Reference the Universal Schema**: The DA incorporates an existing `act:ActivitySchema` (e.g., one published by a standards body) into its domain by reference, not by creating a copy.

2.  **Define Domain-Specific Norms**: The DA establishes the set of rules that must be followed when an agent executes the activity within its domain. These norms are defined and managed by the DA.

3.  **Create a Domain-Specific Credential**: The DA defines a unique **CREDENTIAL** that represents an agent's verified ability and authorization to operate in compliance with the local norms. This credential acts as a domain-specific permit.

4.  **Enforce Governance via Credential Gating**: The DA configures its domain's governance policy (i.e., its Policy Enforcement Point) to require any agent wishing to perform the activity to present the specific **CREDENTIAL** from Step 3. The validation of any **CONTRACT** to perform the activity shall fail if the agent does not possess this domain-specific credential.

This model ensures that while the schema remains a universal standard, its execution is always subject to the explicit, verifiable, and non-negotiable rules of the domain in which it is performed. 


==== The Parameter/Binding Pattern: Achieving Contextual Reusability

Complementing the schema/instance pattern is the separation of abstract parameters from their concrete values. This is achieved through the `act:Variable` and `act:VariableBinding` classes.

* `act:Variable` is used within an `act:ActivitySchema` to define a placeholder for an input or output. It has a name (e.g., "target_location") and a type constraint (e.g., must be a `schema:Place`), but no specific value.
* `act:VariableBinding` is used within an `act:Activity` to connect a specific `act:Variable` from the schema to a concrete value (e.g., linking the "target_location" variable to the Internationalized Resource Identifier (IRI) for a specific address).

This design allows `act:ActivitySchema` definitions to be generic and broadly reusable. A single schema for "TransferAsset" can be created, defining abstract variables for "asset_to_transfer," "source_account," and "destination_account." This one schema can then be instantiated in thousands of different `act:Activity` instances, each using `act:VariableBinding` to supply the concrete assets and accounts for a specific transaction. This promotes standardization and prevents the proliferation of near-identical schemas, while ensuring that every `act:Activity` is a complete, self-contained, and auditable record with all its parameters fully resolved. This contextual adaptability fulfills the design goal of allowing one schema to drive many different actual events by plugging in different participants, targets, or parameters as needed.

==== The Composite Model: First-Class-Citizen Workflows

For composite (multi-step) activities, simply listing sub-activities is not sufficient; the model must also describe how those steps connect and in what order they occur. The Activity Module addresses this by introducing two key auxiliary concepts: `act:ActivityStep` and `act:DataLink`. An `ActivityStep` represents a placeholder node in a composite workflow, an identifiable step that executes a particular sub-activity. A `DataLink` is a construct for connecting the data flow between steps.

The decision to model `act:ActivityStep` and `act:DataLink` as first-class `owl:Class` instances rather than simple properties is intentional. It elevates the workflow's structure and data flow to be explicit, addressable, and governable entities. Because a `DataLink` is an individual instance, it can be the subject of its own descriptive statements. This allows implementers to attach additional metadata directly to the data flow, such as quality-of-service requirements (e.g., `ex:maxLatency`), security classifications (e.g., `ex:hasEncryptionLevel`), or even attach an `hsml:Condition` to enforce a policy on the data transfer itself. This enables far more sophisticated security and management patterns than would be possible if data flow were merely an implicit behavior. This design transforms a simple workflow description into a fully governable, introspectable graph of actions that can be inspected, reused, and verified for consistency.

==== The Generic Condition Model: Future-Proofing the Logic

The HSML architecture separates semantic intent from technical implementation. This is exemplified by the `hsml:Condition` model, defined in the HSML Core Module and used extensively by this Activity Module for properties like `act:hasPrecondition` and `act:hasEffect`.

The `hsml:Condition` class is abstract; it represents the idea that a condition exists without specifying how that condition must be evaluated. The actual evaluation logic is delegated to concrete subclasses, such as `hsml:SHACLCondition` or `hsml:SPARQLCondition`. This architectural choice is a powerful future-proofing mechanism. By having `act:ActivitySchema` reference the abstract `hsml:Condition`, the standard is not permanently locked into any single validation technology. While the Shapes Constraint Language (SHACL) and SPARQL are the initial supported implementations, the P2874 working group can introduce new subclasses in the future—for example, `hsml:SmartContractCondition` to represent an on-chain validation check, or `hsml:OpaCondition` to integrate with the Open Policy Agent framework. These new condition types could be adopted without requiring any breaking changes to the core `act:ActivitySchema` model itself. This ensures the long-term relevance and extensibility of the standard, allowing it to evolve alongside the broader technology landscape.

=== Normative Specification of Class Concepts

This clause provides the normative definitions for all class concepts within the HSML Activity Module. Each class is detailed in a table that specifies its URI, description, JSON-LD context name, usage notes, and relationship to other classes. The namespace prefix `act:` refers to `https://www.spatialwebfoundation.org/ns/hsml/activity#`.

[[hsml-activity-class]]
==== act:Activity

An `act:Activity` is a run-time, stateful entity that represents a specific execution of an `act:ActivitySchema`. It is the primary entity for recording and tracking actions.

.act:Activity Class Definition
[cols="1,4",options="header"]
|===
|Attribute |Value

|*Name*
|`act:Activity`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#Activity`

|*JSON-LD Name*
|`"Activity"`

|*Description*
|A concrete, stateful execution of an `act:ActivitySchema`. It is the record of an action that has been, is being, or is planned to be performed.

|*Superclasses*
|`hsml:Entity`

|*Usage Notes*
|An `act:Activity` instance `shall` be created for every action that is planned, executed, or recorded. It `shall` link to its defining `act:ActivitySchema` via `act:activitySchema` and `shall` contain `act:VariableBinding` instances for all required inputs. Its `act:status` property tracks its lifecycle.
|===

==== act:ActivitySchema

An `act:ActivitySchema` is a reusable, design-time template that defines a type of activity.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:ActivitySchema`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#ActivitySchema`

|*JSON-LD Name*
|`"ActivitySchema"`

|*Description*
|A reusable template for a type of activity, defining its logic, interface (inputs and outputs), preconditions, and effects.

|*Superclasses*
|`hsml:Entity`

|*Subclasses*
|`act:AtomicActivitySchema`, `act:CompositeActivitySchema`

|*Usage Notes*
|Schemas define the interface (`act:hasInput`, `act:hasOutput`), preconditions, and effects of an activity type. They are intended to be published and reused across multiple `act:Activity` instances.
|===

==== act:AtomicActivitySchema

An `act:AtomicActivitySchema` is a schema for a simple, indivisible activity that is not broken down into smaller steps within this model.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:AtomicActivitySchema`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#AtomicActivitySchema`

|*JSON-LD Name*
|`"AtomicActivitySchema"`

|*Description*
|A schema for a simple, indivisible activity that does not internally reference other `ActivitySchemas`.

|*Superclasses*
|`act:ActivitySchema`

|*Usage Notes*
|Used for fundamental operations whose internal logic is opaque to the HSML model (e.g., invoking an external API, performing a cryptographic operation).
|===

==== act:CompositeActivitySchema

An `act:CompositeActivitySchema` is a schema for a complex workflow composed of other activities.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:CompositeActivitySchema`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#CompositeActivitySchema`

|*JSON-LD Name*
|`"CompositeActivitySchema"`

|*Description*
|A schema for a complex workflow defined in terms of a sequence or combination of other activities.

|*Superclasses*
|`act:ActivitySchema`

|*Usage Notes*
|This class is the basis for modeling multi-step processes. It `shall` contain `act:ActivityStep` and `act:DataLink` instances and `shall` define a control flow using exactly one of the control flow properties.
|===

==== act:ActivityStep

An `act:ActivityStep` is a unique, addressable step within a `CompositeActivitySchema`.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:ActivityStep`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#ActivityStep`

|*JSON-LD Name*
|`"ActivityStep"`

|*Description*
|A unique, addressable step within a `CompositeActivitySchema`. Each step is an element of the workflow and points to an `ActivitySchema` that it executes.

|*Superclasses*
|`owl:Thing`

|*Usage Notes*
|An `ActivityStep` acts as a node in a workflow graph. It does not represent the logic itself, but rather a placeholder in the workflow that uses an `act:ActivitySchema` to define its logic via the `act:usesSchema` property.
|===

==== act:DataLink

An `act:DataLink` is a directed "wire" that defines the flow of data within a `CompositeActivitySchema`.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:DataLink`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#DataLink`

|*JSON-LD Name*
|`"DataLink"`

|*Description*
|A directed "wire" defining data flow. It can connect two internal steps, a composite's input to a step, or a step's output to a composite's output.

|*Superclasses*
|`owl:Thing`

|*Usage Notes*
|Making `DataLink` a class allows the data flow itself to be an addressable and governable entity. Metadata (e.g., encryption requirements, Quality of Service policies) can be attached directly to the link.
|===

==== act:Variable

An `act:Variable` is a parameter placeholder within an `act:ActivitySchema`.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:Variable`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#Variable`

|*JSON-LD Name*
|`"Variable"`

|*Description*
|A parameter placeholder defined within a schema. It represents an input or output parameter by name and constraint, to be provided or produced when the activity executes.

|*Superclasses*
|`owl:Thing`

|*Usage Notes*
|A `Variable` defines the name and type constraints for an input or output of a schema. It does not hold a value itself. It `shall` have exactly one `act:variableName` and at least one `hsml:hasConstraint` (to define its type and validation constraints).
|===

==== act:VariableBinding

An `act:VariableBinding` connects an `act:Variable` to a concrete value within an `act:Activity`.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:VariableBinding`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#VariableBinding`

|*JSON-LD Name*
|`"VariableBinding"`

|*Description*
|A binding that connects a `Variable` to a concrete value (object or literal) in the context of an `Activity`. Each `VariableBinding` exists as part of an `Activity` instance.

|*Superclasses*
|`owl:Thing`

|*Usage Notes*
|This class is the bridge between the abstract schema and the concrete activity. It uses `act:bindsVariable` to point to the schema's `Variable` and `act:hasValue` to provide the concrete data for a specific execution.
|===

=== Normative Specification of Property Concepts

This clause provides the normative definitions for all property concepts within the HSML Activity Module. Properties are grouped by their functional role. Each property is detailed in a table specifying its URI, JSON-LD name, description, domain, range, cardinality, and requirement level. Cardinality and requirement levels are derived from the normative SHACL shapes in Annex B.

==== Core Activity Properties

These properties define the fundamental characteristics of activities and their schemas.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:activitySchema`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#activitySchema`

|*JSON-LD Name*
|`"activitySchema"`

|*Description*
|Links an `act:Activity` instance to the `act:ActivitySchema` it implements.

|*Domain*
|`act:Activity`

|*Range*
|`act:ActivitySchema`

|*Cardinality*
|`1..1`

|*Requirement Level*
|Mandatory
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:performedBy`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#performedBy`

|*JSON-LD Name*
|`"performedBy"`

|*Description*
|Identifies the `hsml:Agent` (or agents) responsible for performing an `act:Activity`.

|*Domain*
|`act:Activity`

|*Range*
|`hsml:Agent`

|*Cardinality*
|`1..*`

|*Requirement Level*
|Mandatory
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:status`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#status`

|*JSON-LD Name*
|`"status"`

|*Description*
|The current lifecycle state of an `act:Activity`. The value `shall` be one of: "Planned", "Ongoing", "Completed", "Failed".

|*Domain*
|`act:Activity`

|*Range*
|`xsd:string`

|*Cardinality*
|`1..1`

|*Requirement Level*
|Mandatory
|===

==== Interface and Binding Properties

These properties define the public interface of an `act:ActivitySchema` and connect abstract variables to concrete values.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasInput`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasInput`

|*JSON-LD Name*
|`"hasInput"`

|*Description*
|Declares a `Variable` as an input for an `ActivitySchema`. Inputs are parameters that must be provided for the activity.

|*Domain*
|`act:ActivitySchema`

|*Range*
|`act:Variable`

|*Cardinality*
|`0..*`

|*Requirement Level*
|Optional
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasOutput`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasOutput`

|*JSON-LD Name*
|`"hasOutput"`

|*Description*
|Declares a `Variable` as an output for an `ActivitySchema`. Outputs are results produced by the activity.

|*Domain*
|`act:ActivitySchema`

|*Range*
|`act:Variable`

|*Cardinality*
|`0..*`

|*Requirement Level*
|Optional
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasBinding`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasBinding`

|*JSON-LD Name*
|`"hasBinding"`

|*Description*
|Associates a `VariableBinding` with an `Activity`, indicating that a variable has been bound to a value.

|*Domain*
|`act:Activity`

|*Range*
|`act:VariableBinding`

|*Cardinality*
|`0..*`

|*Requirement Level*
|Conditional (An `act:Activity` `should` have a binding for each required input of its schema).
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:bindsVariable`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#bindsVariable`

|*JSON-LD Name*
|`"bindsVariable"`

|*Description*
|Connects a `VariableBinding` to the `Variable` it parameterizes.

|*Domain*
|`act:VariableBinding`

|*Range*
|`act:Variable`

|*Cardinality*
|`1..1`

|*Requirement Level*
|Mandatory
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasValue`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasValue`

|*JSON-LD Name*
|`"hasValue"`

|*Description*
|The concrete value (IRI) or data (Literal) assigned in a `VariableBinding`.

|*Domain*
|`act:VariableBinding`

|*Range*
|`owl:Thing`

|*Cardinality*
|`1..1`

|*Requirement Level*
|Mandatory
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:variableName`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#variableName`

|*JSON-LD Name*
|`"variableName"`

|*Description*
|The human-readable, symbolic name of a `Variable`.

|*Domain*
|`act:Variable`

|*Range*
|`xsd:string`

|*Cardinality*
|`1..1`

|*Requirement Level*
|Mandatory
|===

==== 3.3 Condition Properties

These properties link an `act:ActivitySchema` to logical conditions.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasPrecondition`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasPrecondition`

|*JSON-LD Name*
|`"hasPrecondition"`

|*Description*
|Specifies conditions on the world state required before execution can proceed.

|*Domain*
|`act:ActivitySchema`

|*Range*
|`hsml:Condition`

|*Cardinality*
|`0..*`

|*Requirement Level*
|Optional
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasEffect`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasEffect`

|*JSON-LD Name*
|`"hasEffect"`

|*Description*
|Describes the expected state of the world after successful completion of the activity.

|*Domain*
|`act:ActivitySchema`

|*Range*
|`hsml:Condition`

|*Cardinality*
|`0..*`

|*Requirement Level*
|Optional
|===

==== Composite Workflow Properties

These properties are used to construct a `CompositeActivitySchema`.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasStep`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasStep`

|*JSON-LD Name*
|`"hasStep"`

|*Description*
|Connects a composite schema to a constituent `ActivityStep`.

|*Domain*
|`act:CompositeActivitySchema`

|*Range*
|`act:ActivityStep`

|*Cardinality*
|`1..*`

|*Requirement Level*
|Mandatory
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:usesSchema`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#usesSchema`

|*JSON-LD Name*
|`"usesSchema"`

|*Description*
|Links an `ActivityStep` to the `ActivitySchema` defining its logic.

|*Domain*
|`act:ActivityStep`

|*Range*
|`act:ActivitySchema`

|*Cardinality*
|`1..1`

|*Requirement Level*
|Mandatory
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasDataLink`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasDataLink`

|*JSON-LD Name*
|`"hasDataLink"`

|*Description*
|Connects a composite schema to a `DataLink` that defines data wiring.

|*Domain*
|`act:CompositeActivitySchema`

|*Range*
|`act:DataLink`

|*Cardinality*
|`0..*`

|*Requirement Level*
|Optional
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:sourceStep`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#sourceStep`

|*JSON-LD Name*
|`"sourceStep"`

|*Description*
|Identifies the source `ActivityStep` for a `DataLink`. Omitted for composite input links.

|*Domain*
|`act:DataLink`

|*Range*
|`act:ActivityStep`

|*Cardinality*
|`0..1`

|*Requirement Level*
|Conditional
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:targetStep`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#targetStep`

|*JSON-LD Name*
|`"targetStep"`

|*Description*
|Identifies the target `ActivityStep` for a `DataLink`. Omitted for composite output links.

|*Domain*
|`act:DataLink`

|*Range*
|`act:ActivityStep`

|*Cardinality*
|`0..1`

|*Requirement Level*
|Conditional
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:sourceVariable`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#sourceVariable`

|*JSON-LD Name*
|`"sourceVariable"`

|*Description*
|Identifies the source `Variable` for a `DataLink`.

|*Domain*
|`act:DataLink`

|*Range*
|`act:Variable`

|*Cardinality*
|`1..1`

|*Requirement Level*
|Mandatory
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:targetVariable`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#targetVariable`

|*JSON-LD Name*
|`"targetVariable"`

|*Description*
|Identifies the target `Variable` for a `DataLink`.

|*Domain*
|`act:DataLink`

|*Range*
|`act:Variable`

|*Cardinality*
|`1..1`

|*Requirement Level*
|Mandatory
|===

==== Control Flow Properties

These properties define the execution logic of a `CompositeActivitySchema`. A composite schema `shall` use exactly one of these properties.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasOrderedSteps`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasOrderedSteps`

|*JSON-LD Name*
|`"hasOrderedSteps"`

|*Description*
|Defines a strict sequence of `ActivityStep`s. The value `shall` be a well-formed `rdf:List`.

|*Domain*
|`act:CompositeActivitySchema`

|*Range*
|`rdf:List`

|*Cardinality*
|`0..1`

|*Requirement Level*
|Conditional
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasChoice`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasChoice`

|*JSON-LD Name*
|`"hasChoice"`

|*Description*
|Defines a set of mutually exclusive `ActivityStep` options. `Shall` link to two or more steps if used.

|*Domain*
|`act:CompositeActivitySchema`

|*Range*
|`act:ActivityStep`

|*Cardinality*
|`0..*`

|*Requirement Level*
|Conditional
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:hasUnorderedSteps`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#hasUnorderedSteps`

|*JSON-LD Name*
|`"hasUnorderedSteps"`

|*Description*
|Defines a set of `ActivityStep`s with no prescribed execution order, which may be executed concurrently.

|*Domain*
|`act:CompositeActivitySchema`

|*Range*
|`act:ActivityStep`

|*Cardinality*
|`0..*`

|*Requirement Level*
|Conditional
|===

==== Execution Traceability Properties

These properties are used in `act:Activity` instances to create an auditable execution trace.

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:subActivityOf`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#subActivityOf`

|*JSON-LD Name*
|`"subActivityOf"`

|*Description*
|Links a sub-activity to its parent composite activity instance.

|*Domain*
|`act:Activity`

|*Range*
|`act:Activity`

|*Cardinality*
|`0..1`

|*Requirement Level*
|Mandatory (for any sub-activity of a composite).
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`act:precededBy`

|*URI*
|`https://www.spatialwebfoundation.org/ns/hsml/activity#precededBy`

|*JSON-LD Name*
|`"precededBy"`

|*Description*
|Links a sequential sub-activity to the one that came directly before it.

|*Domain*
|`act:Activity`

|*Range*
|`act:Activity`

|*Cardinality*
|`0..1`

|*Requirement Level*
|Mandatory (for sub-activities in a sequence, except the first).
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`schema:startTime`

|*URI*
|`https://schema.org/startTime`

|*JSON-LD Name*
|`"startTime"`

|*Description*
|The timestamp marking the start of the activity's execution. Reused from Schema.org.

|*Domain*
|`act:Activity`

|*Range*
|`xsd:dateTime`

|*Cardinality*
|`0..1`

|*Requirement Level*
|Optional
|===

[cols="1,4"]

|===
|Attribute |Value

|*Name*
|`schema:endTime`

|*URI*
|`https://schema.org/endTime`

|*JSON-LD Name*
|`"endTime"`

|*Description*
|The timestamp marking the end of the activity's execution. Reused from Schema.org.

|*Domain*
|`act:Activity`

|*Range*
|`xsd:dateTime`

|*Cardinality*
|`0..1`

|*Requirement Level*
|Optional
|===

=== Modeling of Composite Activities

This clause specifies the normative rules for constructing complex, multi-step workflows using the `act:CompositeActivitySchema` class.

==== The Composite Pattern: ActivityStep and DataLink

A `CompositeActivitySchema` `shall` be composed of one or more `act:ActivityStep` instances and zero or more `act:DataLink` instances.

An `act:ActivityStep` `shall` function as an addressable node within the workflow graph defined by the composite schema. Each `act:ActivityStep` `shall` use the `act:usesSchema` property to reference exactly one `act:ActivitySchema` that defines the logic for that step. This referenced schema may be either atomic or another composite schema, allowing for nested workflows.

An `act:DataLink` `shall` function as a directed edge in the workflow graph, representing the flow of data. This formal "wiring" is necessary for composite logic, as it makes the dependencies between steps explicit and machine-checkable.

==== Control Flow Constructs

An `act:CompositeActivitySchema` `shall` define its internal control flow by using exactly one of the following three properties: `act:hasOrderedSteps`, `act:hasChoice`, or `act:hasUnorderedSteps`. This mutual exclusivity is normatively enforced by the `sh:xone` constraint in the `act:CompositeActivitySchemaShape` (see Annex B).

* *Sequence (`act:hasOrderedSteps`)*: If this property is used, its value `shall` be a well-formed `rdf:List` where each member of the list is an `act:ActivityStep`. The steps `shall` be executed by an orchestration engine in the strict order defined by the list.
* *Choice (`act:hasChoice`)*: If this property is used, it `shall` link to two or more `act:ActivityStep` instances. These steps represent mutually exclusive execution paths. An orchestration engine `shall` select and execute exactly one of the specified choice steps.
* *Set (`act:hasUnorderedSteps`)*: If this property is used, it `shall` link to one or more `act:ActivityStep` instances. These steps have no prescribed execution order and may be executed in any sequence or in parallel, subject to data dependencies defined by `act:DataLink` instances.

==== Interface Wiring and Data Flow Management

The `act:DataLink` class is used to manage the flow of data between steps and across the boundary of the composite schema. The following normative rules apply, as enforced by the `act:DataLinkInterfaceShape` and `act:DataLinkTypeConsistencyShape` (see Annex B).

* *Internal Wiring*: To connect the output of one step to the input of another, an `act:DataLink` `shall` specify the `act:sourceStep`, `act:sourceVariable`, `act:targetStep`, and `act:targetVariable`.
* *Input Wiring*: To connect a public input of the `CompositeActivitySchema` to the input of an internal step, an `act:DataLink` `shall` be created that omits the `act:sourceStep` property. For such a link, the `act:sourceVariable` `shall` be a variable that is declared as an `act:hasInput` on the parent `CompositeActivitySchema`.
* *Output Wiring*: To expose the output of an internal step as a public output of the `CompositeActivitySchema`, an `act:DataLink` `shall` be created that omits the `act:targetStep` property. For such a link, the `act:targetVariable` `shall` be a variable that is declared as an `act:hasOutput` on the parent `CompositeActivitySchema`.
* *Type Consistency*: For any `act:DataLink`, the type constraint of the `act:sourceVariable` `should` be compatible with the type constraint of the `act:targetVariable`. The `act:DataLinkTypeConsistencyShape` provides a normative check for this compatibility.

=== Execution and Traceability Model

This clause specifies the normative requirements for creating a run-time trace of an executed activity. This model ensures that a complete and auditable record of all actions is preserved.

==== Instantiation of Composite Activities

When an orchestration engine begins the execution of a `CompositeActivitySchema`, it `shall` first create a parent `act:Activity` instance corresponding to the composite schema itself. As the engine proceeds to execute each constituent `act:ActivityStep` defined within the composite, it `shall` create a new, distinct child `act:Activity` instance for each step executed.

==== Normative Requirements for Traceability Links

To ensure a complete and unambiguous provenance graph, the following linking properties `shall` be used on all child `act:Activity` instances created during the execution of a composite activity.

* *Compositional Link (`act:subActivityOf`)*: Every child `Activity` created from an `ActivityStep` `shall` be linked to its parent composite `Activity` using exactly one `act:subActivityOf` property. This creates the compositional hierarchy, clearly defining which actions are part of a larger workflow.
* *Sequential Link (`act:precededBy`)*: For workflows defined with `act:hasOrderedSteps`, every child `Activity` (except for the first one in the sequence) `shall` be linked to the `Activity` instance of the immediately preceding step using exactly one `act:precededBy` property.

The combined use of these two properties creates a comprehensive, dual-axis traceability graph. The `act:subActivityOf` links provide the compositional or "part-of" hierarchy, while the `act:precededBy` links provide the temporal and causal sequence. Together, they allow for the complete and unambiguous reconstruction of a complex event, which is critical for auditing, debugging, and establishing legal or operational accountability.

